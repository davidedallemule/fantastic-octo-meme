<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Color Sound</title>
</head>
<body>
  <video id="video" width="300" autoplay></video>
  <canvas id="canvas" width="300" height="225" style="display:none;"></canvas>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Mappa colore -> frequenza nota
    const colorToNote = {
      red: 261.63,   // DO
      green: 293.66, // RE
      yellow: 329.63,// MI
      blue: 349.23,  // FA
    };

    // Funzione per riconoscere il colore dominante semplice
    function getDominantColor(data) {
      const r = data[0], g = data[1], b = data[2];
      if (r > 150 && g < 100 && b < 100) return 'red';
      if (g > 150 && r < 100 && b < 100) return 'green';
      if (r > 150 && g > 150 && b < 100) return 'yellow';
      if (b > 150 && r < 100 && g < 100) return 'blue';
      return null;
    }

    function playNote(freq) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioCtx.createOscillator();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
      oscillator.connect(audioCtx.destination);
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.5); // suono breve
    }

    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
      setInterval(() => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const frame = ctx.getImageData(150, 112, 1, 1).data; // pixel centrale
        const color = getDominantColor(frame);
        if (color && colorToNote[color]) {
          playNote(colorToNote[color]);
        }
      }, 1000); // ogni secondo
    }).catch(err => {
      console.error('Errore accesso webcam:', err);
    });
  </script>
</body>
</html>
